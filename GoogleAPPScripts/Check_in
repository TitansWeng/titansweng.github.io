{"files":
    [{"id":"723f3a51-4140-4a8e-ba80-8abf6b1c359b","name":"程式碼","type":"server_js","source":"function doGet(e) {\n  var params \u003d e.parameter;\n  var card_number \u003d params.card_number;\n  var today \u003d \u0027*\u0027 + params.today;  //因為了讓sheet轉成文字，所以日期格式改為  *0000/00/00\n  var time \u003d params.time;\n  \n  //將Sheet指定為\"資料表\"試算表  SpreadSheet \u003d  試算表\n  var SpreadSheet \u003d SpreadsheetApp.openById(\"1VbJanValnNIHfZ9ujsFNUIw9XJCYglFdCBa7mtexUUs\");\n  //取得頁簽:\"簽到狀況\"\n  var Sheet \u003d SpreadSheet.getSheetByName(\"簽到狀況\");\n  var Sheet_time \u003d SpreadSheet.getSheetByName(\"簽到時間\");\n  //取得所有資料的最後一行\"行數\"\n  var LastRaw \u003d Sheet.getLastRow();\n  var LastCol \u003d Sheet.getLastColumn();\n  \n  //尋找本次簽到日期\n  check_dates \u003d Sheet.getRange(1,1,1,LastCol).getValues();\n  var checkDateIndex;\n  for(i\u003d0;i\u003cLastCol;i++){\n    if(today \u003d\u003d check_dates[0][i]){\n      checkDateIndex \u003d i+1;\n      break;\n    }\n  }\n  if(checkDateIndex \u003d\u003d undefined)return ContentService.createTextOutput(\u00272\u0027 + \u0027,\u0027 + \"簽到日期錯誤(找無今天簽到表格)\");;\n  \n  \n  //取得整個資料庫(跟試算表IO很耗時間，跟不停讀取比起來，一次大量讀取進來處理效能會提升很多)\n  var card_numbers \u003d [];\n  for(i \u003d 0;i \u003c LastRaw ; i++){\n    card_numbers[i] \u003d [];\n  }\n  card_numbers \u003d Sheet.getRange(1,3,LastRaw).getValues();\n  \n  //宣告欲回傳值(避免在for迴圈內重複宣告，節省記憶體位置)\n  var name,status;\n  \n  for(i\u003d0;i\u003cLastRaw;i++){\n    if(card_numbers[i] \u003d\u003d card_number){\n      name \u003d Sheet.getRange(i+1,2).getValues();\n      status \u003d Sheet.getRange(i+1,checkDateIndex).getValues();\n      \n      if(status \u003d\u003d \"未報到\"){\n        //將報到人的資料改為已報到，因陣列從0開始1，所以在寫回去時需加1\n        Sheet.getRange(i+1,checkDateIndex).setValue(\u0027已報到\u0027);\n        Sheet.getRange(i+1,checkDateIndex).setBackground(\u0027green\u0027);\n        Sheet_time.getRange(i+1,checkDateIndex).setValue(time);\n        Sheet_time.getRange(i+1,checkDateIndex).setBackground(\u0027green\u0027);\n        return ContentService.createTextOutput(\u00270\u0027 + \u0027,\u0027  + name + \u0027 報到成功\u0027);\n      }else{\n        return ContentService.createTextOutput(\u00271\u0027 + \u0027,\u0027  + name + \u0027 重複報到\u0027);\n      }\n    }\n  }\n  return ContentService.createTextOutput(\"3\" + \u0027,\u0027 + \"沒找到資料\");\n}"},{"id":"f9e9d350-e593-4dd6-b385-97d58e88b746","name":"Debug","type":"server_js","source":"function myFunction() {\n  doGet(\n    {parameter:\n     {\n       card_number:111222333,\n       today: \"2016/09/06\",\n       time: \"20:57:20\"\n     }\n    }\n  );\n}\n"}]}
